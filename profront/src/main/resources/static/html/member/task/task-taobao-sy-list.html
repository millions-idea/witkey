<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>试用列表</title>
    <meta charset="UTF-8">
    <title>间接推荐人</title>
    <link rel="stylesheet" type="text/css" href="../../../dist/css/index-skin.css">
    <link rel="stylesheet" type="text/css" href="../../../dist/css/index-tp.css">

    <script type="text/javascript" src="../../../dist/js/lang.js"></script>
    <script type="text/javascript" src="../../../dist/js/config.js"></script>
    <script type="text/javascript" src="../../../dist/js/jquery-2.0.0.min.js"></script>
    <script type="text/javascript" src="../../../dist/js/common.js"></script>

    <script type="text/javascript" src="../../../dist/js/admin.js"></script>
    <script type="text/javascript" src="../../../dist/js/page.js"></script>

    <link rel="stylesheet" type="text/css" href="../../../dist/css/jq-tip.css">
    <script type="text/javascript" src="../../../dist/js/jq-tip.js"></script>
    <script type="text/javascript" src="../../../dist/js/layer.js"></script>

    <script type="text/javascript" src="../../../dist/js/jquery.form.js"></script>
    <script type="text/javascript" src="../../../dist/js/template7.min.js"></script>
    <script type="text/javascript" src="../../../dist/js/cm.js"></script>
    <script type="text/javascript" src="../../../dist/js/ypfunction.js"></script>
    <!--日期处理-->
    <script type="text/javascript" src="../../../dist/js/moment.js"></script>

    <link rel="stylesheet" href="http://001.topaaa.com/file/script/layim/css/layui.css">
    <!--配置服务器连接地址 -->
    <script type="text/javascript" src="../../../dist/js/gjy_serviceurl.js"></script>

    <script src="https://cdn.bootcss.com/react/16.4.0/umd/react.development.js"></script>
    <script src="https://cdn.bootcss.com/react-dom/16.4.0/umd/react-dom.development.js"></script>
    <script src="https://cdn.bootcss.com/babel-standalone/6.26.0/babel.min.js"></script>

    <link rel="stylesheet" href="../../../dist/layui/css/layui.css">
    <script type="text/javascript" src="../../../dist/layui/layui.js"></script>

    <style type="text/css">
        #pages {
            display: flex;
            justify-content: center;
        }

        .layui-laypage-center {

        }
    </style>

</head>


<BODY class=rwdt_bg>
<div id="body">
    <div id="body_header"></div>
    <script>
        $("#body_header").load("../public/public-top.html");
    </script>
    <div id="content_wrapper">
        <div id="content_body_title"></div>
        <script>
            $("#content_body_title").load("../public/public-body-title.html");
        </script>

    <!--<INPUT id=catid type=hidden value=5> <INPUT id=w type=hidden>-->
    <DIV id=content>
        <DIV id=moveContent>
            <DIV>
                <DIV class=yptip_dating></DIV>
                <div id=slide-cat>
                    <UL>
                        <LI style="HEIGHT: 40px">商品类目：</LI>
                        <LI><A class=act onclick="goodClass(0)"
                               href="javascript:;">全部类目</A></LI>
                        <LI><A onclick="goodClass(1)"
                                href="javascript:;">潮流女装</A></LI>
                        <LI><A onclick="goodClass(2)"
                                href="javascript:;">时尚男装</A></LI>
                        <LI><A onclick="goodClass(3)"
                                href="javascript:;">鞋子箱包</A></LI>
                        <LI><A onclick="goodClass(4)"
                                href="javascript:;">数码家电</A></LI>
                        <LI><A onclick="goodClass(5)"
                                href="javascript:;">美食特产</A></LI>
                        <LI><A onclick="goodClass(6)"
                                href="javascript:;">居家日用</A></LI>
                        <LI><A onclick="goodClass(7)"
                                href="javascript:;">母婴用品</A></LI>
                        <LI><A onclick="goodClass(8)"
                                href="javascript:;">护肤彩妆</A></LI>
                        <LI><A onclick="goodClass(9)"
                                href="javascript:;">珠宝配饰</A></LI>
                        <LI><A onclick="goodClass(10)"
                                href="javascript:;">家装家纺</A></LI>
                        <LI><A onclick="goodClass(11)"
                                href="javascript:;">车品车饰</A></LI>
                        <LI><A onclick="goodClass(12)"
                                href="javascript:;">运动户外</A></LI>
                        <LI><A onclick="goodClass(13)"
                                href="javascript:;">家庭保健</A></LI>
                        <LI><A onclick="goodClass(14)"
                                href="javascript:;">中老年用</A></LI>
                        <LI><A onclick="goodClass(15)"
                                href="javascript:;">其他类目</A></LI>
                    </UL>
                    <ul>
                        <LI>商品排序：</LI>
                        <LI><A class=act
                               onclick="orderBy(1);"
                               href="javascript:;">最新 ↓
                        </A></LI>
                        <LI>
                            <A onclick="orderBy(2);" href="javascript:;">
                                价值
                                ↓ </A></LI>
                        <li><A onclick="orderBy(3);" href="javascript:;">奖励
                            ↓ </A></li>
                        <li>

                            <form class='yptasksearch'  method=post><input
                                    name=itemid class=c32
                                    id='taskinfo' onfocus="if(value=='试用编号搜索...'){value=''}"
                                    onblur="if(value=='') {value='试用编号搜索...'}"
                                    type=text value=试用编号搜索...>

                                <button id='taskid' type='button' onclick="findById()">
                                    搜索
                                </button>
                            </form>
                        </li>
                        <li class=fr><A onclick=switch_grid()>切换视图</A></li>
                        <li class=fr><A id=autorefresh>自动刷新</A></li>
                    </ul>
                </div>
                <div class=cle></div>
                <div id=taobao-lists>
                    <div id=taskList>
                        <div class=cle></div>


                    </div>
                </div>
                <DIV class=cle></DIV>
            </DIV>
        </DIV>
    </DIV>

    <!--分页-->
    <div id='pages'>
    </div>

    <STYLE>#dialog {
        BORDER-TOP: #fff 1px solid;
        BORDER-RIGHT: #fff 1px solid;
        WIDTH: 520px;
        BORDER-BOTTOM: #fff 1px solid;
        PADDING-BOTTOM: 20px;
        PADDING-TOP: 20px;
        PADDING-LEFT: 20px;
        BORDER-LEFT: #fff 1px solid;
        DISPLAY: none;
        PADDING-RIGHT: 20px;
        BACKGROUND-COLOR: #fff
    }
    </STYLE>
    <!-- 对话框 -->
    <DIV id=dialog>
        <DIV class=tip>

        </DIV>
        <!--买号列表-->
        <div>
            <span id="buy_account_list">

            </span>
            <!--<A class='accurl' onclick="jierenwu('13062411179');">-->
                <!--<EM class='iyellow'>-->
                    <!--13062411179-->
                <!--</EM>-->
                <!--<SPAN class='xin6'></SPAN>-->
            <!--</A>-->
            <!--<A class=accurl onclick="jierenwu('思思之狂');">-->
                <!--<EM class=iyellow>思思之狂</EM>-->
                <!--<SPAN class=xin3></SPAN>-->
            <!--</A>-->

            <DIV class=cle></DIV>
            <DIV class=addtaobaohao><A href="../bind/bind-buy-taobao.html" target="_blank">添加买号</A>
            </DIV>
        </div>
        <DIV class=cle></DIV>
    </DIV><!-- end对话框 --><input id=yptask_itemid type=hidden>
    <INPUT id=yptask_ischeck type=hidden>


    <SCRIPT type="text/babel">
        //买号
        class BuyAccount extends React.Component {
            constructor(props) {
                super(props)
            }

            //接受任务
            picTask = (id,event)=>{
                let good_id = this.props.list[0].good_id;

                let params = {};

                params.memid = userresult_json.id;
                //商品id
                params.goods_id = good_id;
                //买号Id
                params.buy_id = id;

                //提交
                $.ajax({
                    url: request_url + "intf_shop/pickTask",
                    type: "post",
                    data: params,
                    dataType: 'json',
                    headers: {
                        "mobile": userresult_json.mobile,
                        "token": userresult_json.token
                    },
                    success: function (result) {
                        if (result.error == 0) {

                        }
                    }
                });
                //buy_id

                // if (response == 'success') {
                //     layer.confirm('申请成功，是否继续申请？', {
                //         btn: ['继续申请', '前往试用管理'] //按钮
                //     }, function (index) {
                //         window.location.reload();
                //     }, function () {
                //         if ($("#yptask_ischeck").val() == '1') window.location = '/member/yptaskview.php?pro=1';
                //         else window.location = '/member/yptaskview.php?pro=2';
                //     });
                // } else {
                //     layer.alert(response);
                // }

            };

            render () {
                let list = this.props.list;
                //显示信誉图片
                if(list!=null && list.length>0){
                    for(let i=0;i<list.length;i++){
                        list[i].honor = 'xin'+list[i].honor ;
                    }
                }

                return (
                    <span id="taskList">{
                        list.map((data, index) =>
                            <a className='accurl' onClick={this.picTask.bind(this,data.id)}>
                                <em className='iyellow'>
                                    {data.account}
                                </em>
                                <span className={data.honor}></span>
                            </a>
                        )
                    }
                    </span>
                )
            }
        }

        //排序
        function orderBy(num) {
            let order = "";
            switch (num) {
                case 1:
                    order = "?order_by=1";
                    break;
                case 2:
                    order = "?order_by=2";
                    break;
                case 3:
                    order = "?order_by=3";
                    break;
            }
            window.location.href = "task-taobao-sy-list.html" + order;
        }

        //分类查询
        function goodClass(type){
            window.location.href = "task-taobao-sy-list.html?class_type=" + type;
        }

        //按照id搜索
        function findById(){
            let id = $("#taskinfo").val();
            window.location.href = "task-taobao-sy-list.html?good_id=" + id;
        }

        $(function () {
            set_nav("yptask", "on");
            //从页面刚进来加载
            loadData();
        });


        //任务项
        class TaskItem extends React.Component {
            constructor(props) {
                super(props)
            }

            //点击申请试用
            alertAccount = (id , event)=>{

                let params = {};
                params.memid = userresult_json.id;
                params.goods_id = id;

                $.ajax({
                    url: request_url + "intf_shop/preRecvTask",
                    type: "post",
                    data: params,
                    dataType: 'json',
                    headers: {
                        "mobile": userresult_json.mobile,
                        "token": userresult_json.token
                    },
                    success: function (result) {
                        if (result.error == 0) {
                            let json = jQuery.parseJSON(result.list);

                            //放入商品id
                            if(json!=null && json.length>0){
                                for(let i=0;i<json.length;i++){
                                    json[i].good_id = id ;
                                }
                            }

                            ReactDOM.render(<BuyAccount list={json} />, document.getElementById('buy_account_list'))

                            $("#yptask_itemid").val(10000);
                            $("#yptask_ischeck").val(0);

                            $("#dialog .tip").html('请在下面选择一个买号申请试用');
                            layer.open({
                                type: 1,
                                title: '请选择一个买号申请免费试用',
                                area: ['auto', 'auto'],
                                shadeClose: true,
                                content: $('#dialog')
                            });
                        }else{
                            alert(result.message);
                        }
                    }
                });



            };

            render() {
                let list = this.props.list;

                return (
                    <div id="taskList">{
                        list.map((data, index) =>

                            <div className='c4' key={index}>
                                <div className='c41'>
                                    <div className='c42'>
                                        <span className='addtime'>
                                            发布时间：{data.pub_time}
                                        </span>
                                        <img width='16'
                                             height='16'
                                             title='阿里巴巴试用'
                                             align='absMiddle'
                                             src="/dist/img/cat_5.png"/>
                                        试用编号：
                                        {data.id}
                                    </div>
                                    <div className='c43'>
                                        <div className='my1'>
                                            <img className='c46'
                                                 src={data.goods_img}
                                                 data-qtip-img-height="300"
                                                 data-qtip-img-width="0"
                                            />

                                            <div>
                                                {data.search_word}
                                            </div>
                                        </div>
                                        <div className='my2'>
                                            <ul>
                                                <li>发布商家：
                                                    <span className='f_red'>
                                                       {data.shop_name}
                                                    </span>
                                                    <span className='vip'><img
                                                        title='1级VIP客户'
                                                        src="/dist/img/vip1.gif"/>
                                                </span>
                                                </li>
                                                <li><span className='shiyong_hide'>试用</span>金额：
                                                    <span title='试用的下单金额'
                                                          className='f_red'>
                                                        {data.price}
                                                    </span> 元
                                                </li>
                                                <li><span className='shiyong_hide'>悬赏</span>
                                                    奖励：<span title='完成试用后，您能获得的试用奖励'
                                                             className='f_red'>
                                                        {data.append_money}
                                                    </span> 元
                                                </li>
                                            </ul>

                                            <div className='requirements'>
                                                {
                                                    data.requires.map(function (name, index) {
                                                        return (
                                                            <em title='任务金额的返款方式'
                                                                className={data.color_class[index]}>
                                                                {name}
                                                            </em>
                                                        )
                                                    })

                                                }
                                            </div>
                                        </div>
                                        <div className='my3'>
                                            <a className="qrw_btn button border-blue"
                                               itemID="2967788"
                                               goods_id='100'
                                               onClick={this.alertAccount.bind(this, data.id)}
                                               ischeck="0">
                                                申请试用
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )
                    }</div>
                );

            }
        }


        /**
         * 加载数据
         * @param obj
         */
        function loadData(obj) {
            //请求数据
            let params = {};
            params.memid = userresult_json.id;
            //获取地址栏参数
            let Request = new Object();
            Request = GetRequest();
            let order;
            //排序
            order = Request['order_by'];
            if (order != undefined && order != null) {
                params.order_by = order;
            }
            //页数
            let url_page = Request['page'];
            if (url_page != undefined && url_page != null) {
                params.page = url_page;
            }

            //商品类型
            let class_type = Request['class_type'];
            if (class_type != undefined && class_type != null) {
                params.class_type = class_type;
            }
            //id
            let good_id = Request['good_id'];
            if (good_id != undefined && good_id != null) {
                params.good_id = good_id;
            }

            $.ajax({
                url: request_url + "intf_shop/loadUserTaskList",
                type: "post",
                data: params,
                dataType: 'json',
                headers: {
                    "mobile": userresult_json.mobile,
                    "token": userresult_json.token
                },

                success: function (result) {
                    if (result.error == 0) {
                        console.log(result);
                        //下线列表
                        let pageinfo = jQuery.parseJSON(result.pageInfo);
                        //当前页
                        let pageNum = pageinfo.pageNum;
                        //数据
                        let list = pageinfo.list;

                        //分页
                        layui.use('laypage', function () {
                            let laypage = layui.laypage;

                            laypage.render({
                                elem: 'pages',
                                theme: 'center'
                                , count: pageinfo.total  //数据总数，从服务端得到
                                , curr: pageNum //获取起始页
                                , jump: function (obj, first) {
                                    //首次不执行
                                    if (!first) {
                                        let current = obj.curr;
                                        let url = "task-taobao-sy-list.html?page=" + current;

                                        if (order != undefined && order != null) {
                                            url += '&order_by=' + order;
                                        }
                                        if (class_type != undefined && class_type != null) {
                                            url += '&class_type=' +class_type;
                                        }

                                        window.location.href = url;
                                    }
                                }
                            });
                        });

                        let orgSet = localStorage.getItem("setting");
                        let setting = jQuery.parseJSON(orgSet);

                        //时间转化
                        for (let i = 0; i < list.length; i++) {
                            let org_time = list[i].pub_time;
                            if (undefined != org_time && org_time != null) {
                                list[i].pub_time =
                                    moment(org_time, 'MMM DD,YYYY HH:mm:ss A', 'en').format('YYYY-MM-DD HH:mm:ss');
                            }
                            //显示默认图片
                            // let img_url = setting.goods_default_img;
                            // if (img_url.startWith("http:")) {
                            //     //直接显示网络图片
                            //     list[i].goods_img = setting.goods_default_img;
                            // }else {
                            //     //显示服务器上的图片
                            //     list[i].goods_img = img_prefix_url + setting.goods_default_img;
                            // }
                            list[i].goods_img = setting.goods_default_img;
                        }


                        // 渲染虚拟DOM
                        ReactDOM.render(<TaskItem list={list} />, document.getElementById('taobao-lists'))

                    } else {
                        alert(result.message);
                    }
                }
            });
        }
    </SCRIPT>

    <SCRIPT type=text/javascript>
        function jierenwu(xiaohao) {
            $.ajax({
                type: 'POST',
                url: '/yptask/acc.php',
                data: {
                    itemid: $("#yptask_itemid").val(),
                    taobaohao: xiaohao
                },
                success: function (response) {
                    if (response == 'success') {
                        layer.confirm('申请成功，是否继续申请？', {
                            btn: ['继续申请', '前往试用管理'] //按钮
                        }, function (index) {
                            window.location.reload();
                        }, function () {
                            if ($("#yptask_ischeck").val() == '1') window.location = '/member/yptaskview.php?pro=1';
                            else window.location = '/member/yptaskview.php?pro=2';
                        });
                    } else {
                        layer.alert(response);
                    }
                }
            });
        }

        $(function () {
            $('.qrw_btn').click(function () {
                var itemid = ($(this).attr("itemid"));
                $("#yptask_itemid").val(itemid);
                var ischeck = ($(this).attr("ischeck"));
                $("#yptask_ischeck").val(ischeck);
                $("#dialog .tip").html('请在下面选择一个买号申请试用');
                layer.open({
                    type: 1,
                    title: '请选择一个买号申请免费试用',
                    area: ['auto', 'auto'],
                    shadeClose: true,
                    content: $('#dialog')
                });
            });
        });
        // 设置一个div作为遮罩层，当显示对话框时填满浏览器窗口
        $('<div id="qtip-blanket">')
            .css({
                position: 'fixed',
                top: 0, // Use document scrollTop so it's on-screen even if the window is scrolled
                left: 0,
                height: '100%',//height: $(document).height(), // Span the full document height...
                width: '100%', // ...and full width
                opacity: 0.2, // 设置遮罩层透明
                backgroundColor: 'black',
                zIndex: 5000  // tootip 的Zindex都是在 6000以上 为了确保 遮罩层在对话框一下，设置为5000
            })
            .appendTo(document.body) // 增加到文档中
            .hide(0); // 初始化的时候隐藏
        //自动刷新
        $(function () {
            // var switch_grid = get_cookie('switch_grid');
            // if (!switch_grid) {
            //     $('#taskList').addClass('shiyong');
            //     $("[data-qtip-img]").qtip({
            //         position: {my: 'center bottom', at: 'top center', adjust: {x: 10}},
            //         style: {classes: 'qtip-bootstrap'}
            //     });
            // }
            // var autorefresh = getCookie('autorefresh');
            // var autorefreshid = 0;
            // $('#autorefresh').click(function () {
            //     if ($('#autorefresh').text() == '自动刷新') {
            //         setCookie('autorefresh', 1);
            //         location.reload();
            //     } else {
            //         if (autorefreshid) clearInterval(autorefreshid);
            //         setCookie('autorefresh', 0);
            //         $('#autorefresh').text('自动刷新').attr('title', '点击自动刷新');
            //     }
            // });
            // if (autorefresh == 1) {
            //     $('#autorefresh').text('取消自动刷新').attr('title', '点击取消自动刷新');
            //     autorefreshid = setTimeout('location.reload()', 10000);
            // }
        });

        function switch_grid() {
            $('#taskList').toggleClass('shiyong');
            setTimeout(function () {
                if ($('#taskList').hasClass('shiyong')) {
                    set_cookie('switch_grid', '');
                    $("[data-qtip-img]").qtip({
                        position: {my: 'center bottom', at: 'top center', adjust: {x: 10}},
                        style: {classes: 'qtip-bootstrap'}
                    });
                } else {
                    set_cookie('switch_grid', 1);
                    qtip_init();
                }
            }, 100);
        }
    </SCRIPT>


    <DIV style="CLEAR: both"></DIV>
    <DIV id=footer>
        <DIV id=footer_top>
            <DIV id=foot_top_1><A
                    href="http://001.topaaa.com/about/index.php?itemid=10">代理加盟</A><SPAN> |
</SPAN><A href="http://001.topaaa.com/about/index.php?itemid=9">辅助业务</A><SPAN> |
</SPAN><A href="http://001.topaaa.com/about/index.php?itemid=8">网站活动</A><SPAN> |
</SPAN><A href="http://001.topaaa.com/about/index.php?itemid=7">联系客服</A><SPAN> |
</SPAN><A href="http://001.topaaa.com/about/index.php?itemid=6">联盟网规</A><SPAN> |
</SPAN><A href="http://001.topaaa.com/about/index.php?itemid=1">关于我们</A><SPAN> |
</SPAN><A href="http://001.topaaa.com/about/index.php?itemid=3">联系方式</A><SPAN> |
</SPAN><A href="http://001.topaaa.com/about/index.php?itemid=4">使用协议</A><SPAN> |
</SPAN><A href="http://001.topaaa.com/about/index.php?itemid=5">版权隐私</A><SPAN> |
</SPAN></DIV>
            <DIV id=copy_right>(c)2013-2018 销量联盟 www.topaaa.com All Rights Reserved</DIV>
            <DIV style="WIDTH: 1024px; TEXT-ALIGN: center; MARGIN: 20px auto 0px"><IMG
                    src="任务_销量联盟_files/1.png"> <IMG src="任务_销量联盟_files/2.png"> <IMG
                    src="任务_销量联盟_files/3.png"> <IMG src="任务_销量联盟_files/4.png"> <IMG
                    src="任务_销量联盟_files/5.png"> <IMG src="任务_销量联盟_files/6.png"> <IMG
                    src="任务_销量联盟_files/7.png"> <IMG src="任务_销量联盟_files/8.png"></DIV>
            <DIV style="CLEAR: both"></DIV>
        </DIV>
    </DIV>
</DIV>


<DIV class=main-im>
    <DIV class=open-im id=open_im style="DISPLAY: none"></DIV>
    <DIV class=im_main id=im_main>
        <DIV class=close-im id=close_im><A title=点击关闭 class=you
                                           style="CURSOR: pointer"></A></DIV>
        <A class="im-qq qq-a" onclick=multi_qq()>
            <DIV class=qq-container></DIV>
            <DIV class=qq-hover-c><IMG class=img-qq
                                       src="任务_销量联盟_files/qq.png"></DIV>
            <SPAN>QQ在线咨询</SPAN> </A>

        <DIV class=im-tel>
            <DIV><A href="http://001.topaaa.com/announce/index.php?typeid=2"
                    target=_blank>如何发布试用</A></DIV>
            <DIV><A href="http://001.topaaa.com/announce/index.php?typeid=3"
                    target=_blank>如何申请试用</A></DIV>
            <DIV><A href="http://001.topaaa.com/about/index.php?itemid=6"
                    target=_blank>销量联盟网规</A></DIV>
            <DIV><A class=jsbz href="http://001.topaaa.com/announce/index.php?typeid=1"
                    target=_blank>网站公告</A></DIV>
        </DIV>
        <DIV class=im-footer style="POSITION: relative">
            <DIV class=go-top><A title=返回顶部 class=you style="CURSOR: pointer"></A></DIV>
            <DIV style="CLEAR: both"></DIV>
        </DIV>
    </DIV>
    <SCRIPT>
        $(function () {
            $(".go-top").click(function () {
                $('html,body').animate({scrollTop: 0}, 800);
            });
            $("#close_im").click(function () {
                $("#im_main").fadeOut(500, function () {
                    $("#open_im").fadeIn(500);
                });
            });
            $("#open_im").click(function () {
                $("#open_im").fadeOut(500, function () {
                    $("#im_main").fadeIn(500);
                });
            });
        });
    </SCRIPT>
</DIV>
<SCRIPT type=text/javascript>
    show_task('moduleid=23&html=index');
</SCRIPT>
</BODY>
</HTML>
